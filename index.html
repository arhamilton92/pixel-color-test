<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <style>
        canvas {
            background-color:blanchedalmond;
        }
        #origImg {
            background-color: blanchedalmond;
        }
        p {
          text-align: center;
        }
    </style>
  </head>
  <body>
    <div class="container d-flex justify-content-center mt-5">
      <div class="row">
        <div class="col-md-6">
            <h3>Map Image</h3>
          <img id="origImg" src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/a65b7269-062e-43df-ba67-7d4dbb2fcc23/de0tufi-6e1282e1-edcb-406f-a08c-58645164fdb6.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOiIsImlzcyI6InVybjphcHA6Iiwib2JqIjpbW3sicGF0aCI6IlwvZlwvYTY1YjcyNjktMDYyZS00M2RmLWJhNjctN2Q0ZGJiMmZjYzIzXC9kZTB0dWZpLTZlMTI4MmUxLWVkY2ItNDA2Zi1hMDhjLTU4NjQ1MTY0ZmRiNi5wbmcifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6ZmlsZS5kb3dubG9hZCJdfQ.r2ucqRn8XPcmCQdrarr6-cGdO38F0YlYzpGYzzayBQQ" alt="Original image">
          </div>
          <!-- /col-md-4 -->
        <div class="col-md-6">
            <h3>New Colors</h3>
          <canvas id="myCanvas" width="250" height="250">  
        </div> <!-- /col-md-4 -->
      </div> <!-- /row -->
    </div>
    
    <div class="container d-flex justify-content-center">
      <div class="row">
        <div class="col-12 mt-3">
            <button id="newcolor">Click to generate a new color!</button>
        </div>
      </div>
    </div>
    <div class="container d-flex justify-content-center">
      <div class="row">
        <div class="col-12 mt-5 textcenter">
            <p>This is automatically applying preset pallettes to the map image shown on the left.</p>
            <p>Additionally, marking images are recolored and overlayed onto and combined into the first image.</p>
        </div>
      </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="colors.js"></script>
<script type="text/javascript">

console.log(baseCoat)
let num;
let markNum;
const canvas = document.getElementById("myCanvas");
const ctx = canvas.getContext("2d");    
let id;

const spotty = "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/a65b7269-062e-43df-ba67-7d4dbb2fcc23/de0syh2-6ec35ca0-3e1d-4ee5-af55-90442ecfbeed.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOiIsImlzcyI6InVybjphcHA6Iiwib2JqIjpbW3sicGF0aCI6IlwvZlwvYTY1YjcyNjktMDYyZS00M2RmLWJhNjctN2Q0ZGJiMmZjYzIzXC9kZTBzeWgyLTZlYzM1Y2EwLTNlMWQtNGVlNS1hZjU1LTkwNDQyZWNmYmVlZC5wbmcifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6ZmlsZS5kb3dubG9hZCJdfQ.nBJpox6LANbUrMeJeWqn1-z9oGsGclVZZoq8-JsWynU"
const smallStripe = "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/a65b7269-062e-43df-ba67-7d4dbb2fcc23/de0tl0j-51987eeb-323e-47da-b1fa-a18acaeeff0c.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOiIsImlzcyI6InVybjphcHA6Iiwib2JqIjpbW3sicGF0aCI6IlwvZlwvYTY1YjcyNjktMDYyZS00M2RmLWJhNjctN2Q0ZGJiMmZjYzIzXC9kZTB0bDBqLTUxOTg3ZWViLTMyM2UtNDdkYS1iMWZhLWExOGFjYWVlZmYwYy5wbmcifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6ZmlsZS5kb3dubG9hZCJdfQ.nFXBWmkBjrm7JpIV2CmBAUj-LRz6Yylimer_4AEjZRs"

window.onload = function(){
  combineImage();
}

function combineImage() {
    randomMarking();
    var img1 = new Image();
    
    img1.onload = function(){ alterImage(this); }
    img1.src = "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/a65b7269-062e-43df-ba67-7d4dbb2fcc23/de0tufi-6e1282e1-edcb-406f-a08c-58645164fdb6.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOiIsImlzcyI6InVybjphcHA6Iiwib2JqIjpbW3sicGF0aCI6IlwvZlwvYTY1YjcyNjktMDYyZS00M2RmLWJhNjctN2Q0ZGJiMmZjYzIzXC9kZTB0dWZpLTZlMTI4MmUxLWVkY2ItNDA2Zi1hMDhjLTU4NjQ1MTY0ZmRiNi5wbmcifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6ZmlsZS5kb3dubG9hZCJdfQ.r2ucqRn8XPcmCQdrarr6-cGdO38F0YlYzpGYzzayBQQ"
    img1.crossOrigin = "Anonymous";
    console.log(markNum + " marking")
    
    if (markNum !== 0) {
    var img2 = new Image();
    
    img2.onload = function(){ alterImage(this); }
    if (markNum == 1) {
      img2.src = spotty;
    }if (markNum == 2) {
      img2.src = smallStripe;
    }
    if (markNum == 3) {
      var img3 = new Image();
      img3.onload = function(){ alterImage(this); }
      img2.src = spotty;
      img3.src = smallStripe;
      img3.crossOrigin = "Anonymous";
    }
    img2.crossOrigin = "Anonymous";
    }
}


function alterImage(imageObj){     
  let image = imageObj;
  ctx.drawImage(imageObj, 0, 0);
  id = ctx.getImageData(0, 0, canvas.width, canvas.height);
  colorImage();
}

function colorImage() {
  if (id !== undefined) {
  randomColor();
  color = colors[num];

  // Iterate over data.  Data is RGBA matrix so go by +=4 to get to next pixel data.
  let selectedColor = baseCoat[num]
  console.log(selectedColor)

  for (i = 0; i < id.data.length; i += 4) {
    if (id.data[i] == 255 && id.data[i + 1] == 255 &&  id.data[i + 2] == 0) {
        id.data[i] = selectedColor.base[0];
        id.data[i + 1] = selectedColor.base[1];
        id.data[i + 2] = selectedColor.base[2];
    }
    if (id.data[i] == 255 && id.data[i + 1] == 0 &&  id.data[i + 2] == 0) {
        id.data[i] = selectedColor.line[0];
        id.data[i + 1] = selectedColor.line[1];
        id.data[i + 2] = selectedColor.line[2];
        
    }
    if (id.data[i] == 0 && id.data[i + 1] == 134 &&  id.data[i + 2] == 255) {
        id.data[i] = selectedColor.shade[0];
        id.data[i + 1] = selectedColor.shade[1];
        id.data[i + 2] = selectedColor.shade[2];
    }
    if (id.data[i] == 0 && id.data[i + 1] == 255 &&  id.data[i + 2] == 0) {
        id.data[i] = selectedColor.base[0];
        id.data[i + 1] = selectedColor.base[1];
        id.data[i + 2] = selectedColor.base[2];
    }
  }
  ctx.putImageData(id, 0, 0);
}
}

function randomColor() {
    num = Math.floor(Math.random() * colors.length);
}

function randomMarking() {
    markNum = Math.floor(Math.random() * 4);
}

$("#newcolor").on("click", function() {
  combineImage();
})
        </script>
  </body>
</html>